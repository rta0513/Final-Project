# Imports the subprocess package to allow the use of command line tools
import subprocess

# Defines the NMAP funtion to be choosen later by user
def nmap_fun():
    # Informs user of choosen funtion
    print("Welcome to a simple NMAP python tool!")
    print("<===================================>")
    # Requests target to scan
    nmap_targ = input("Please define the target you wish to scan: ")
    # Confirms target to scan
    print("The target you have choosen is: ", nmap_targ)
    # Requests scan type
    nmap_type = input("Please choose the type of scan you wish to perform:\n"
                      "1)TCP Scan\n"
                      "2)UDP Scan\n"
                      "3)Comprehensive Scan\n"
                      "4)Ping\n"
                      "5)Traceroute\n"
                      "Enter Here: ")
    # Series of if statements decided by the user's previous input
    if nmap_type == "1":
        # Creates and writes to text file to store nmap results
        tcp_res_file = open('C:/Users/radm4/OneDrive/Desktop/tcp.txt', "w")
        tcp_res_file.write("TCP Scan Results: ")
        # Informs user of choosen scan type and target
        print("TCP Scan has been choosen against the target: ", nmap_targ)
        print("Please wait...")
        # The command being ran with choosen option
        # This runs a TCP scan against the 1000 most common ports by default
        nmap_com = ["nmap", "-sS", nmap_targ]
        # The results of command being stored within variable
        nmap_res = subprocess.run(nmap_com, capture_output=True, text=True)
        # Prints the results of command in standard output
        print("Results:\n", nmap_res.stdout)
        # Appends results to and closes text file
        tcp_res_file.write(nmap_res.stdout)
        tcp_res_file.close()
    elif nmap_type == "2":
        # Creates and writes to text file to store nmap results
        udp_res_file = open('C:/Users/radm4/OneDrive/Desktop/udp.txt', "w")
        udp_res_file.write("UDP Scan Results: ")
        # Informs user of choosen scan type and target
        print("UDP scan has been chosen against the target: ", nmap_targ)
        print("Please wait...")
        # The command being ran with choosen option
        # This runs a UDP scan against the 1000 most common ports by default
        nmap_com = ["nmap", "-sU", nmap_targ]
        # The results of command being stored within variable
        nmap_res = subprocess.run(nmap_com, capture_output=True, text=True)
        # Prints the results of command
        print("Results:\n", nmap_res.stdout)
        # Appends results to and closes text file
        udp_res_file.write(nmap_res.stdout)
        udp_res_file.close()
    elif nmap_type == "3":
        # Creates and writes to text file to store nmap results
        comp_res_file = open('C:/Users/radm4/OneDrive/Desktop/comp.txt', "w")
        comp_res_file.write("Comprehensive Scan Results: ")
        # Informs user of choosen scan type and target
        print("Comprehensive scan has been chosen against the target: ", nmap_targ)
        print("Please wait...")
        # The command being ran with choosen option
        # This runs TCP scan, UDP scan, OS detection, version detection
        nmap_com = ["nmap", "-sS", "-sU", "-A", "-sV", nmap_targ]
        # The results of command being stored within variable
        nmap_res = subprocess.run(nmap_com, capture_output=True, text=True)
        # Prints the results of command
        print("Results:\n", nmap_res.stdout)
        # Appends results to and closes text file
        comp_res_file.write(nmap_res.stdout)
        comp_res_file.close()
    elif nmap_type == "4":
        # Creates and writes to text file to store nmap results
        ping_res_file = open('C:/Users/radm4/OneDrive/Desktop/ping.txt', "w")
        ping_res_file.write("Ping Results: ")
        # Informs user of choosen scan type and target
        print("Ping has been chosen against the target: ", nmap_targ)
        print("Please wait...")
        # The command being ran with choosen option
        # This runs a command similar to ping
        nmap_com = ["nmap", "-PE", nmap_targ]
        # The results of command being stored within variable
        nmap_res = subprocess.run(nmap_com, capture_output=True, text=True)
        # Prints the results of command
        print("Results:\n", nmap_res.stdout)
        # Appends results to and closes text file
        ping_res_file.write(nmap_res.stdout)
        ping_res_file.close()
    elif nmap_type == "5":
        # Creates and writes to text file to store nmap results
        trace_res_file = open('C:/Users/radm4/OneDrive/Desktop/trace.txt', "w")
        trace_res_file.write("Traceroute Results: ")
        # Informs user of choosen scan type and target
        print("Traceroute has been chosen against the target: ", nmap_targ)
        print("Please wait...")
        # The command being ran with choosen option
        # This runs a command similar to traceroute
        nmap_com = ["nmap", "--traceroute", nmap_targ]
        # The results of command being stored within variable
        nmap_res = subprocess.run(nmap_com, capture_output=True, text=True)
        # Prints the results of command
        print("Results:\n", nmap_res.stdout)
        # Appends results to and closes text file
        ping_res_file.write(nmap_res.stdout)
        ping_res_file.close()
    else:
        # Occurs when invalid option is choosen
        print("Invalid Option")
